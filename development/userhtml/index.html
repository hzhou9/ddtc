<!DOCTYPE html>
<html>
<head>
    <title>嘟嘟停车</title>
    <meta charset="UTF-8">
    <script src="../golba_rs/js/sys.js"></script>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no"/>

    <link rel="stylesheet" href="../golba_rs/css/mui.min.css">
    <link rel="stylesheet" href="../golba_rs/css/animate.css">
    <link rel="stylesheet" href="./css/main.css">
    <style>
        #keyboard-area-list [name=provinces-list] {overflow:hidden; margin:-15px -15px 0; padding:0 0 3%; background:#fff;}
        #keyboard-area-list [name=provinces-list] li {font-size:14px; list-style:none; float:left; width:9%; margin:3% 0 0 3%; text-align:center; padding:2% 0; border:1px solid #e3e3e3; border-radius:3px;}
    </style>
</head>
<body>
<div style="display: none;position: absolute">
    <script src="http://s11.cnzz.com/z_stat.php?id=1254946209&web_id=1254946209"></script>
</div>
<script src="./js/tongji.js"></script>
<div class="bodypage">
    <div id="main_contaion" class="pagecontainer">
        <div id="canvaswrap" class="mui-off-canvas-wrap page">
            <div class="mui-inner-wrap">
                <div class="mui-content mytabs">
                    <div id="tabbar-with-user" class="mui-control-content" name='parkinfo'>
                    </div>
                    <div id="tabbar-with-collection" class="mui-control-content" name='map'>
                    </div>
                    <div id="tabbar-with-in" class="mui-control-content" name='myorder'>
                    </div>
                    <div id="tabbar-with-out" class="mui-control-content" name='myorderdetail'>
                    </div>
                    <div class="mui-control-content" name='userinfo'>
                    </div>
                    <div class="mui-control-content" name='freelist'>
                    </div>
                    <div class="mui-control-content" name='coupon'>
                    </div>
                </div>
                <!-- off-canvas backdrop -->
            </div>
        </div>
    </div>

    <div id="pop_pagecontaion" class="pagecontainer" style="display: none">
        <div class="page" style="background-color:#fff">
        </div>
    </div>

    <div class="pagecontainer toppagecontainer" animname='anim_rightin' style="display: none">
        <div class="page">
        </div>
        <div name="coverpage" class="coverpage">
        </div>
    </div>
    <div class="pagecontainer toppagecontainer" animname='anim_rightin' style="display: none">
        <div class="page">
        </div>
        <div name="coverpage" class="coverpage">
        </div>
    </div>
    <div class="pagecontainer toppagecontainer" animname='anim_rightin' style="display: none">
        <div class="page">
        </div>
        <div name="coverpage" class="coverpage">
        </div>
    </div>
    <div class="pagecontainer toppagecontainer" animname='anim_rightin' style="display: none">
        <div class="page">
        </div>
        <div name="coverpage" class="coverpage">
        </div>
    </div>
    <div class="pagecontainer toppagecontainer" animname='anim_rightin' style="display: none">
        <div class="page">
        </div>
        <div name="coverpage" class="coverpage">
        </div>
    </div>
    <div id="tophead" class="pagecontainer" animname='anim_rightin' style="display: none">
        <header class="mui-bar mui-bar-nav">
            <a name='btclose' class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>

            <h1 class="mui-title"></h1>
        </header>
    </div>

    <div id="topheardpagecontainer" class="pagecontainer topheardpagecontainer" animname='anim_rightin'
         style="display: none">
        <header class="mui-bar mui-bar-nav mui-bar-top">
            <a name='btupclose' class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>

            <h1 class="mui-title"></h1>
            <button class="mui-btn mui-btn-link mui-btn-nav mui-pull-right main-icon-lit">
                <a class="mui-icon mui-icon-gear mui-pull-right"></a>
            </button>
        </header>
    </div>
    <div id="coupon_pagecontaion" class="pagecontainer" style="display: none">
        <div class="page" style="background-color:#fff">
        </div>
    </div>
    <div id="reg_pagecontaion" class="pagecontainer" style="display: none">
        <div class="page" style="background-color:#fff">
        </div>
    </div>
    <div id="top_menu" class="pagecontainer" style=" display: none">
        <div class="mui-popover mui-active" style="display: block;">
            <ul class="mui-table-view" name='list'>
                <li class="mui-table-view-cell" name='title'></li>
                <li class="mui-table-view-cell" name='title'></li>
                <li class="mui-table-view-cell" name='title'></li>
            </ul>
            <ul class="template">
                <li class="mui-table-view-cell" name='title'></li>
            </ul>
        </div>
        <div name='make' class="mui-backdrop mui-active"></div>
    </div>
    <div id="reg_dialog_pagecontainer" class="pagecontainer" style=" display: none;z-index: 500">
        <div name="loginpanel" class="mui-slider-item mui-control-content mui-active loginpanel  animated zoomIn">
            <div class="mui-input-row reg-user">
                <h1 class="iconrow">嘟嘟停车</h1>
                <span name='btclose' class="mui-icon mui-icon-close"></span>
                <hr>
                <p name='msg'>手机号就是您在嘟嘟停车的账号</p>
                <input name="userpanel_phone" type="text" class="mui-input-clear" placeholder="请输入您的手机号" >
                <p>新用户请填写车牌</p>
                <table cellpadding=0 cellspacing=0 style="width:100%;">
                    <tr><td style="vertical-align:top;"><b class="mui-navigate-down" name="btarea" style="line-height:40px;">沪</b></td><td><input name="userpanel_chepai" type="text" maxlength=6 pattern="^[A-z0-9]{6}$" class="mui-input-clear" placeholder="车牌用于停车场确认" ></td></tr>
                </table>
                <button name="btreg" class="mui-btn mui-btn-warning mui-btn-block">确认</button>
            </div>
        </div>
        <div name='make' class="mui-backdrop mui-active"></div>
    </div>
    <div id="alert_pagecontainer" class="pagecontainer" style=" display: none">
        <div class="mui-popover mui-active" style="display: block;">
            <ul class="mui-table-view">
                <li class="mui-table-view-cell" name='title'></li>
                <li class="mui-table-view-cell" name='msg'></li>
            </ul>
        </div>
        <div name='make' class="mui-backdrop mui-active"></div>
    </div>
    <div id="confirm_pagecontainer" class="pagecontainer" style=" display: none;z-index: 500">
        <div class="mui-popover mui-active" style="display: block;">
            <ul class="mui-table-view">
                <li class="mui-table-view-cell title" name='title'></li>
                <li class="mui-table-view-cell msg" name='msg'></li>
                <li class="mui-table-view-cell">
                    <table style="width: 80%">
                        <tr>
                            <td>
                                <div class="mui-btn mui-btn-red  mui-pull-right" name="btcancel">取 消</div>
                            </td>
                            <td>
                                <div class="mui-btn mui-btn-success  mui-pull-right" name="btok">确 认</div>
                            </td>
                        </tr>
                    </table>
                </li>
            </ul>
        </div>
        <div name='make' class="mui-backdrop mui-active"></div>
    </div>
    
    <div style="display:none;top:0;position: absolute;width: 100%;height: 100%;background: rgba(0,0,0,.3);z-index: 1000;" id="keyboard-area-list-bg">
        <div id="keyboard-area-list" style="display:none;position: absolute;bottom: 0;width: 100%;">
            <ul class="mui-table-view">
                <li class="mui-table-view-cell">
                    <ul name="provinces-list">
                    </ul>
                </li>
                <li class="mui-table-view-cell" style="text-align: center;">
                    <a name="close_keyboard-area-list"><b>取消</b></a>
                </li>
            </ul>
        </div>
    </div>
    

    <div id="loading" class="tips-loading"></div>
    <div id="startpage" class="startpage">
        嘟嘟停车
        <p class="mui-bar-footer">duduche.me</p>
    </div>
</div>
<div class="template">

</div>
<!--
<div class="template"><div class="mapPluginInit_mk1" name="map_control_home"></div></div>
-->
</body>

<script src="../golba_rs/js/jquery-1.9.1.min.js"></script>

<script src="../golba_rs/js/iscroll.js" __del__></script>

<script src="./js/cfg.js" __del__></script>
<script src="./js/utils.js" __del__></script>
<script src="./js/manager.js" __del__></script>
<script src="./js/ajax.js" __del__></script>
<script src="./js/view.js" __del__></script>
<script src="./js/map_plugin.js" __del__></script>

<script src="./views/map/map.js" __del__></script>
<script src="./views/searchmap/searchmap.js" __del__></script>
<script src="./views/myorder/myorder.js" __del__></script>
<script src="./views/myorderdetail/myorderdetail.js" __del__></script>
<script src="./views/reg/reg.js" __del__></script>
<script src="./views/userinfo/userinfo.js" __del__></script>
<script src="./views/coupon/coupon.js" __del__></script>
<script src="./views/couponget/couponget.js" __del__></script>
<script src="./views/parkinfo/parkinfo.js" __del__></script>
<script src="./views/daohang/daohang.js" __del__></script>
<script src="./views/orderpay/orderpay.js" __del__></script>
<script src="./views/discover/discover.js" __del__></script>
<script src="./views/freelist/freelist.js" __del__></script>

<script __scrolljs__></script>
<script __alljs__></script>
<script __viewjs__></script>


<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script>
    document.ontouchmove = function (e) {     //文档禁止 touchmove事件
        return false;
    };
    $(function () {
        window.sysmanager.init();


        //tab
        var tabcontrols = $('[name=tabscontrol]');
        var tabcards = $('.mytabs>div');
        var tabs = window.testtabs = utils.jq.initTab(tabcontrols, tabcards, '  mui-active');
        var nowview = null;

        tabs.activeHandle[6] = tabs.activeHandle[5] = tabs.activeHandle[4] = tabs.activeHandle[3] = tabs.activeHandle[2] = tabs.activeHandle[1] = tabs.activeHandle[0] = function (context) {
            viewManager.viewroot('views/');
            var viewname = context.attr('name');
            var view = viewManager.loadview(viewname, function (v) {
                context.empty();
                v.renderer(context);
                if (nowview) {
                    nowview.obj.close();
                }
                nowview = v;
            });

        };

        function iCheckLogin(fn) {
            sysmanager.checkLogin(function (islogin) {
                if (islogin) {
                    fn && fn();
                }
                else {
                    sysmanager.loadpage('views/', 'reg', $('#reg_pagecontaion'), null, function (view) {
                        view.obj.onclose = function () {
                            if (myajax.uid()) {
                                fn && fn();
                            }
                        };
                    });

                }
            });
        }

        function initstart(model) {
            if (!model) {
                model = utils.tools.getUrlParam('m');
            }
            switch (model) {
                case 'myorder':
                    iCheckLogin(function () {
                        tabs.activeTab(2, true);
                    });
                    break;
                case 'neworder':
                case 'myjiesuan':
                    iCheckLogin(function () {
                        tabs.activeTab(3, true);
                    });
                    break;
                case 'userinfo':
                case 'userorder':
                    iCheckLogin(function () {
                        tabs.activeTab(4, true);
                    });
                    break;
                case 'freelist':
                    tabs.activeTab(5);
                    break;
                case 'coupon':
                    iCheckLogin(function () {
                        tabs.activeTab(6, true);
                    });
                    break;
                case 'parkinfo':
                    tabs.activeTab(0, true);
                    break;
                case "map":
                case "mapsearch":
                case "discover":
                default :
                    tabs.activeTab(1, true);
                    break;
            }
            $('#startpage').hide();
        }

        function type_1() {
            initstart();
            setTimeout(function () {
                $('#startpage').hide();
            });
        }

        function type_2() {
            initstart();
            setTimeout(function () {
                $('#startpage').hide();
            });
        }

        function type_3() {      //已经注册
            var userinfo = {
                uid: utils.tools.getUrlParam('uid'), uuid: utils.tools.getUrlParam('uuid')
            }
            window.myajax.userinfo(userinfo);
            initstart();
            setTimeout(function () {
                $('#startpage').hide();
            });
        }

        function type_10() {     //领取红包
            $('title').html('嘟嘟停车抢红包啦');
            var code = utils.tools.getUrlParam('hcode');
            var fromid = utils.tools.getUrlParam('fromid') || 0;
            sysmanager.couponUI(code, fromid);
            setTimeout(function () {
                $('#startpage').hide();
            });
        }

        function loadwxfunc() {
            var script = document.createElement("script");
            script.type = "text/javascript";
            script.src = "./js/wxfunc.js";
            document.body.appendChild(script);
        }

        if (!sysmanager.isapp) {
            loadwxfunc();
        }

        var type = utils.tools.getUrlParam('type') || '1';
        var openid = utils.tools.getUrlParam('openid');

        switch (type) {
            case '1':       //非openid模式
                type_1();
                break;
            case '2':       //openid未注册
                type_2();
                break;
            case '3':       //openid注册
                type_3();
                break;
            case '10':      //领取红包
                type_10();
                break;
        }

        window.clear2Init = function (model) {
            utils.tools.setUrlParam('m', model);
            sysmanager.pagecontainerManager.clearviews();
            initstart(model);
            setTimeout(function () {
                window.parent.postMessage(JSON.stringify({t: 'navack'}), '*');
            });
        };

        window.addEventListener("message", function (event) {
            var data = JSON.parse(event.data);
            if (data.t == 'nav') {
                var model = data.d;
                clear2Init(model);
            } else if (data.t == 'ack') {//心跳信号
                setTimeout(function () {
                    window.parent.postMessage(JSON.stringify({t: 'navack'}), '*');
                });
            } else if (data.t == 'pushid') {
                window.pushid = data.d;
            } else if (data.t == 'wechatshare') {
                if (window._wechatshare_callback) {
                    window._wechatshare_callback(data.d);
                }
            } else if (data.t == 'setpushid') {//提交pushid
                window.pushid = data.d;
                window.myajax.userget('index', 'setPushid', {pushid: data.d}, function (result) {}, null, false);
            } else if (data.t == 'windowclose') {//windowclose
                window._map_windowclose_callback(data.d);
            } else if (data.t == 'setlocation') {
                if (window._map_location_callback != null) {
                    window._map_location_callback(data.d);
                } else {
                    window.TongjiObj.map('geolocation', 'nocallback');
                }
            } else if (data.t == 'msgdata') {//消息
                var msg = data.d;//json消息对象
                //console.log('msgdata:'+msg);
            }

        }, false);

    });

</script>


</html>